<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iuran KKG PAI Nagreg</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #1e88e5;
            --primary-dark: #1565c0;
            --secondary: #26a69a;
            --warning: #ff9800;
            --danger: #ef5350;
            --success: #66bb6a;
            --dark: #263238;
            --light: #f5f5f5;
            --gradient: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            --gradient-success: linear-gradient(135deg, #26a69a 0%, #00897b 100%);
            --gradient-danger: linear-gradient(135deg, #ef5350 0%, #c62828 100%);
            --gradient-warning: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            --gradient-purple: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            background: var(--light);
            min-height: 100vh;
        }

        /* ========== NAVBAR ========== */
        .navbar {
            background: var(--gradient);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
            text-decoration: none;
        }

        .navbar-brand i {
            font-size: 2rem;
        }

        .navbar-brand h1 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .navbar-brand span {
            font-size: 0.8rem;
            opacity: 0.9;
            display: block;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .online-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            color: white;
            font-size: 0.85rem;
        }

        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse-dot 2s infinite;
        }

        .online-dot.offline {
            background: #f44336;
            animation: none;
        }

        @keyframes pulse-dot {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-light {
            background: white;
            color: var(--primary);
        }

        .btn-light:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255,255,255,0.4);
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(30,136,229,0.4);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* ========== HERO ========== */
        .hero {
            background: var(--gradient);
            padding: 4rem 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23f5f5f5" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,154.7C960,171,1056,181,1152,165.3C1248,149,1344,107,1392,85.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.2);
            padding: 0.7rem 1.5rem;
            border-radius: 50px;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        /* ========== RUNNING TEXT ========== */
        .running-banner {
            background: var(--gradient-danger);
            padding: 0.8rem 0;
            overflow: hidden;
        }

        .running-track {
            display: flex;
            animation: runningText 30s linear infinite;
            white-space: nowrap;
        }

        .running-track:hover {
            animation-play-state: paused;
        }

        @keyframes runningText {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .running-item {
            color: white;
            font-weight: 600;
            padding: 0 3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .running-item i {
            color: #ffd700;
        }

        /* ========== MARQUEE SECTION ========== */
        .marquee-section {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 2.5rem 0;
            overflow: hidden;
        }

        .marquee-header {
            text-align: center;
            color: white;
            padding: 0 2rem 2rem;
        }

        .marquee-header h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .marquee-header p {
            opacity: 0.8;
            font-size: 0.95rem;
        }

        .marquee-container {
            position: relative;
            overflow: hidden;
        }

        .marquee-container::before,
        .marquee-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100px;
            z-index: 10;
            pointer-events: none;
        }

        .marquee-container::before {
            left: 0;
            background: linear-gradient(to right, #1a1a2e, transparent);
        }

        .marquee-container::after {
            right: 0;
            background: linear-gradient(to left, #16213e, transparent);
        }

        .marquee-track {
            display: flex;
            animation: marquee 35s linear infinite;
        }

        .marquee-track:hover {
            animation-play-state: paused;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .marquee-card {
            flex-shrink: 0;
            width: 320px;
            margin: 0 15px;
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .marquee-card:hover {
            transform: scale(1.03);
        }

        .marquee-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-danger);
        }

        .marquee-card.partial::before {
            background: var(--gradient-warning);
        }

        .marquee-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .marquee-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: var(--gradient-danger);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(239, 83, 80, 0.4);
        }

        .marquee-card.partial .marquee-avatar {
            background: var(--gradient-warning);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        .marquee-info h4 {
            color: var(--dark);
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }

        .marquee-info p {
            color: #888;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .marquee-debt {
            background: #fff5f5;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .marquee-card.partial .marquee-debt {
            background: #fff8e1;
        }

        .marquee-debt-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .marquee-debt-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger);
        }

        .marquee-card.partial .marquee-debt-amount {
            color: var(--warning);
        }

        .marquee-months {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            justify-content: center;
        }

        .month-tag {
            padding: 0.25rem 0.6rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .month-tag.unpaid {
            background: #ffebee;
            color: var(--danger);
        }

        .month-tag.paid {
            background: #e8f5e9;
            color: var(--success);
        }

        .marquee-cta {
            margin-top: 1rem;
            text-align: center;
        }

        .marquee-cta-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.2rem;
            background: var(--gradient-danger);
            color: white;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse-btn 2s infinite;
        }

        .marquee-card.partial .marquee-cta-btn {
            background: var(--gradient-warning);
        }

        @keyframes pulse-btn {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* All Paid State */
        .all-paid-card {
            width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border-top: 5px solid var(--success);
        }

        .all-paid-card i {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 1rem;
        }

        .all-paid-card h4 {
            color: var(--dark);
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .all-paid-card p {
            color: #666;
        }

        /* ========== COUNTDOWN ========== */
        .countdown-section {
            background: var(--gradient-purple);
            padding: 2rem;
            text-align: center;
            color: white;
        }

        .countdown-title {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .countdown-boxes {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .countdown-box {
            background: rgba(255,255,255,0.2);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            min-width: 80px;
            backdrop-filter: blur(10px);
        }

        .countdown-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .countdown-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* ========== QUOTE ========== */
        .quote-section {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 3rem 2rem;
            text-align: center;
            color: white;
        }

        .quote-box {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .quote-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ffd700;
        }

        .quote-text {
            font-size: 1.2rem;
            font-style: italic;
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .quote-author {
            font-weight: 600;
            opacity: 0.9;
        }

        /* ========== STATS ========== */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.8rem;
            color: white;
        }

        .stat-card:nth-child(1) .stat-icon { background: var(--gradient); }
        .stat-card:nth-child(2) .stat-icon { background: var(--gradient-success); }
        .stat-card:nth-child(3) .stat-icon { background: var(--gradient-warning); }
        .stat-card:nth-child(4) .stat-icon { background: var(--gradient-purple); }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        /* ========== MEMBERS GRID ========== */
        .members-section {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-header h3 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .section-header p {
            color: #666;
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 0.7rem 1.5rem;
            border: none;
            background: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .filter-tab.active {
            background: var(--gradient);
            color: white;
        }

        .filter-tab:hover:not(.active) {
            background: #f0f0f0;
        }

        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .member-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .member-card.unpaid { border-left: 5px solid var(--danger); }
        .member-card.partial { border-left: 5px solid var(--warning); }
        .member-card.paid { border-left: 5px solid var(--success); }

        .member-card-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .member-details h4 {
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
        }

        .member-details p {
            color: #888;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .member-card-body {
            padding: 0 1.5rem 1.5rem;
        }

        .status-box {
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 1rem;
        }

        .status-box.unpaid { background: #fff5f5; }
        .status-box.partial { background: #fff8e1; }
        .status-box.paid { background: #e8f5e9; }

        .status-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 0.3rem;
        }

        .status-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .status-value.unpaid { color: var(--danger); }
        .status-value.partial { color: var(--warning); }
        .status-value.paid { color: var(--success); }

        .months-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 1rem;
        }

        .month-badge {
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .month-badge.unpaid {
            background: #ffebee;
            color: var(--danger);
        }

        .month-badge.paid {
            background: #e8f5e9;
            color: var(--success);
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        .empty-state h4 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: #888;
        }

        /* ========== MODAL ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            overflow: hidden;
            animation: modalSlide 0.3s ease;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            background: var(--gradient);
            padding: 2rem;
            text-align: center;
            color: white;
        }

        .modal-header.danger {
            background: var(--gradient-danger);
        }

        .modal-header i {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .modal-header h3 {
            font-size: 1.4rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 0 2rem 2rem;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(30,136,229,0.1);
        }

        .form-group small {
            color: #888;
            font-size: 0.8rem;
            margin-top: 0.3rem;
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* ========== DASHBOARD ========== */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            background: var(--dark);
            padding: 2rem 0;
            color: white;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .sidebar-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            font-weight: 700;
        }

        .sidebar-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
        }

        .sidebar-role {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .sidebar-menu {
            padding: 1.5rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: var(--primary);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            padding: 2rem;
            background: var(--light);
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title h2 {
            color: var(--dark);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-title p {
            color: #888;
            font-size: 0.9rem;
        }

        .cards-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .info-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .info-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
        }

        .info-card-icon.blue { background: var(--gradient); }
        .info-card-icon.green { background: var(--gradient-success); }
        .info-card-icon.orange { background: var(--gradient-warning); }
        .info-card-icon.red { background: var(--gradient-danger); }
        .info-card-icon.purple { background: var(--gradient-purple); }

        .info-card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        .info-card-label {
            color: #888;
            font-size: 0.9rem;
        }

        .saldo-card {
            background: var(--gradient);
            border-radius: 20px;
            padding: 2rem;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .saldo-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .saldo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .saldo-amount {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .saldo-label {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .saldo-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.2);
            position: relative;
        }

        .saldo-item {
            text-align: center;
        }

        .saldo-item-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .saldo-item-label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .table-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-header h3 {
            color: var(--dark);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
        }

        tr:hover td {
            background: #fafafa;
        }

        .badge {
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #e8f5e9;
            color: var(--success);
        }

        .badge-warning {
            background: #fff8e1;
            color: var(--warning);
        }

        .badge-danger {
            background: #ffebee;
            color: var(--danger);
        }

        .badge-primary {
            background: #e3f2fd;
            color: var(--primary);
        }

        .action-btns {
            display: flex;
            gap: 0.5rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* ========== LOADING ========== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #e0e0e0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1.5rem;
            color: var(--dark);
            font-weight: 500;
            font-size: 1.1rem;
        }

        .loading-subtext {
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* ========== SYNC INDICATOR ========== */
        .sync-indicator {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: var(--dark);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            display: none;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .sync-indicator.show {
            display: flex;
        }

        .sync-indicator i {
            animation: spin 1s linear infinite;
        }

        /* ========== TOAST ========== */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--dark);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 0.8rem;
            z-index: 3000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: toastSlide 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        @keyframes toastSlide {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ========== FOOTER ========== */
        footer {
            background: var(--dark);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        footer p {
            margin-bottom: 0.5rem;
        }

        footer .sub {
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 992px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 260px;
                z-index: 1500;
                box-shadow: 5px 0 30px rgba(0,0,0,0.3);
            }

            .sidebar.active {
                display: block;
            }

            .mobile-menu-btn {
                display: flex !important;
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1400;
            }

            .sidebar-overlay.active {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .navbar-brand h1 {
                font-size: 1.1rem;
            }

            .navbar-brand span {
                display: none;
            }

            .hero {
                padding: 3rem 1.5rem;
            }

            .hero h2 {
                font-size: 1.8rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .marquee-header h3 {
                font-size: 1.2rem;
            }

            .quote-text {
                font-size: 1rem;
            }

            .stats-section {
                padding: 1.5rem;
            }

            .stat-number {
                font-size: 1.6rem;
            }

            .members-grid {
                grid-template-columns: 1fr;
            }

            .saldo-amount {
                font-size: 2rem;
            }

            .saldo-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }

            th, td {
                padding: 0.8rem;
                font-size: 0.85rem;
            }

            .countdown-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .nav-right {
                gap: 0.5rem;
            }

            .online-badge span {
                display: none;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

            .cards-row {
                grid-template-columns: 1fr;
            }

            .toast {
                left: 1rem;
                right: 1rem;
                bottom: 1rem;
                max-width: none;
            }

            .sync-indicator {
                left: 1rem;
                bottom: 5rem;
            }
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        /* ========== SEARCH ========== */
        .search-box {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            gap: 0.5rem;
        }

        .search-box input {
            border: none;
            background: none;
            padding: 0.5rem;
            outline: none;
            font-size: 0.9rem;
            width: 200px;
        }

        .search-box i {
            color: #888;
        }

        /* ========== ALLOCATION ========== */
        .allocation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .allocation-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .allocation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .allocation-title {
            font-weight: 600;
            color: var(--dark);
        }

        .allocation-amount {
            font-weight: 700;
            color: var(--primary);
        }

        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-fill.blue { background: var(--gradient); }
        .progress-fill.green { background: var(--gradient-success); }
        .progress-fill.orange { background: var(--gradient-warning); }
        .progress-fill.purple { background: var(--gradient-purple); }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #888;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Memuat Aplikasi...</div>
        <div class="loading-subtext">Menghubungkan ke database</div>
    </div>

    <!-- Sync Indicator -->
    <div class="sync-indicator" id="syncIndicator">
        <i class="fas fa-sync-alt"></i>
        <span>Menyimpan data...</span>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Berhasil!</span>
    </div>

    <!-- ==================== HOMEPAGE ==================== -->
    <div id="homePage">
        <!-- Navbar -->
        <nav class="navbar">
            <a href="#" class="navbar-brand" onclick="goHome()">
                <i class="fas fa-mosque"></i>
                <div>
                    <h1>KKG PAI Nagreg</h1>
                    <span>Kelompok Kerja Guru PAI</span>
                </div>
            </a>
            <div class="nav-right">
                <div class="online-badge">
                    <div class="online-dot" id="onlineDot"></div>
                    <span id="onlineStatus">Online</span>
                </div>
                <button class="btn btn-light" onclick="showLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login</span>
                </button>
            </div>
        </nav>

        <!-- Hero -->
        <section class="hero">
            <div class="hero-content">
                <h2>ðŸ•Œ Portal Iuran KKG PAI Nagreg</h2>
                <p>Sistem Pengelolaan Iuran Kelompok Kerja Guru Pendidikan Agama Islam Kecamatan Nagreg yang transparan, akuntabel, dan dapat diakses oleh seluruh anggota secara real-time.</p>
                <button class="btn btn-light" onclick="showLogin()">
                    <i class="fas fa-user-circle"></i>
                    Akses Portal Anggota
                </button>
                <div class="hero-badge">
                    <i class="fas fa-cloud"></i>
                    Terhubung ke Cloud Database - Data Realtime
                </div>
            </div>
        </section>

        <!-- Running Text -->
        <div class="running-banner">
            <div class="running-track" id="runningTrack"></div>
        </div>

        <!-- Marquee -->
        <section class="marquee-section">
            <div class="marquee-header">
                <h3>
                    <span class="blink">ðŸ”´</span>
                    PERHATIAN: Anggota yang Belum Melunasi Iuran
                    <span class="blink">ðŸ”´</span>
                </h3>
                <p>"Mari kita jaga amanah bersama. Lunasi iuran tepat waktu untuk kemajuan KKG PAI Nagreg"</p>
            </div>
            <div class="marquee-container">
                <div class="marquee-track" id="marqueeTrack"></div>
            </div>
        </section>

        <!-- Countdown -->
        <section class="countdown-section">
            <div class="countdown-title">
                <i class="fas fa-clock"></i>
                Batas Waktu Pembayaran Iuran Bulan Ini
            </div>
            <div class="countdown-boxes">
                <div class="countdown-box">
                    <div class="countdown-value" id="countDays">00</div>
                    <div class="countdown-label">Hari</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="countHours">00</div>
                    <div class="countdown-label">Jam</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="countMinutes">00</div>
                    <div class="countdown-label">Menit</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="countSeconds">00</div>
                    <div class="countdown-label">Detik</div>
                </div>
            </div>
        </section>

        <!-- Quote -->
        <section class="quote-section">
            <div class="quote-box">
                <div class="quote-icon">
                    <i class="fas fa-quote-left"></i>
                </div>
                <p class="quote-text">
                    "Barangsiapa yang memudahkan urusan orang lain, maka Allah akan memudahkan urusannya di dunia dan akhirat. Dengan membayar iuran tepat waktu, kita bersama-sama membangun kebersamaan dan memajukan pendidikan agama Islam di Kecamatan Nagreg."
                </p>
                <p class="quote-author">- Semangat Kebersamaan KKG PAI -</p>
            </div>
        </section>

        <!-- Stats -->
        <section class="stats-section" id="statsSection"></section>

        <!-- Members List -->
        <section class="members-section">
            <div class="section-header">
                <h3>ðŸ“‹ Status Iuran Semua Anggota</h3>
                <p>Transparansi adalah kunci kepercayaan bersama</p>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterMembers('all')">Semua</button>
                <button class="filter-tab" onclick="filterMembers('unpaid')">Belum Lunas</button>
                <button class="filter-tab" onclick="filterMembers('partial')">Sebagian</button>
                <button class="filter-tab" onclick="filterMembers('paid')">Lunas</button>
            </div>

            <div class="members-grid" id="membersGrid"></div>
        </section>

        <!-- Footer -->
        <footer>
            <p>Â© 2024 KKG PAI Kecamatan Nagreg - Kabupaten Bandung</p>
            <p class="sub">"Bersama Membangun Generasi Qurani"</p>
        </footer>
    </div>

    <!-- ==================== LOGIN MODAL ==================== -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <button class="close-modal" onclick="closeLogin()">Ã—</button>
            <div class="modal-header">
                <i class="fas fa-user-lock"></i>
                <h3>Login Portal KKG PAI</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><i class="fas fa-phone"></i> Nomor HP</label>
                    <input type="tel" id="loginPhone" placeholder="Contoh: 081234567890">
                    <small>Masukkan nomor HP yang terdaftar</small>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-key"></i> NRG (Password)</label>
                    <input type="password" id="loginNRG" placeholder="Masukkan NRG Anda">
                    <small>Nomor Registrasi Guru sebagai password</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-block" onclick="doLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    Masuk
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== DASHBOARD ==================== -->
    <div id="dashboard" class="dashboard">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- Navbar -->
        <nav class="navbar">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="#" class="navbar-brand">
                    <i class="fas fa-mosque"></i>
                    <div>
                        <h1>KKG PAI Nagreg</h1>
                        <span id="navSubtitle">Dashboard</span>
                    </div>
                </a>
            </div>
            <div class="nav-right">
                <div class="online-badge">
                    <div class="online-dot" id="onlineDot2"></div>
                    <span id="onlineStatus2">Online</span>
                </div>
                <button class="btn btn-light" onclick="doLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <div class="dashboard-layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-avatar" id="sidebarAvatar">A</div>
                    <div class="sidebar-name" id="sidebarName">Nama User</div>
                    <div class="sidebar-role" id="sidebarRole">Role</div>
                </div>
                <nav class="sidebar-menu">
                    <div class="menu-item active" onclick="showSection('sectionDashboard')">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionMembers')" id="menuMembers">
                        <i class="fas fa-users"></i>
                        <span>Data Anggota</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionPayments')">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Iuran</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionFinance')">
                        <i class="fas fa-wallet"></i>
                        <span>Keuangan</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionAllocations')" id="menuAllocations">
                        <i class="fas fa-chart-pie"></i>
                        <span>Alokasi Dana</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionReports')">
                        <i class="fas fa-file-alt"></i>
                        <span>Laporan</span>
                    </div>
                    <div class="menu-item" onclick="showSection('sectionSettings')" id="menuSettings">
                        <i class="fas fa-cog"></i>
                        <span>Pengaturan</span>
                    </div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Section -->
                <section id="sectionDashboard" class="content-section active">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                            <p id="welcomeText">Selamat datang!</p>
                        </div>
                        <div id="dateDisplay" style="color: #888;"></div>
                    </div>

                    <div class="cards-row" id="dashboardCards"></div>

                    <div class="saldo-card">
                        <div class="saldo-header">
                            <div>
                                <div class="saldo-label">Total Saldo KKG PAI</div>
                                <div class="saldo-amount" id="saldoAmount">Rp 0</div>
                            </div>
                            <i class="fas fa-wallet" style="font-size: 3rem; opacity: 0.3;"></i>
                        </div>
                        <div class="saldo-details">
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="saldoPemasukan">Rp 0</div>
                                <div class="saldo-item-label">Total Pemasukan</div>
                            </div>
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="saldoPengeluaran">Rp 0</div>
                                <div class="saldo-item-label">Total Pengeluaran</div>
                            </div>
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="saldoTunggakan">Rp 0</div>
                                <div class="saldo-item-label">Total Tunggakan</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3><i class="fas fa-history"></i> Transaksi Terakhir</h3>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Nama</th>
                                        <th>Bulan</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTransactions"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Members Section -->
                <section id="sectionMembers" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-users"></i> Data Anggota</h2>
                            <p>Kelola data anggota KKG PAI</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddMember()">
                            <i class="fas fa-plus"></i>
                            Tambah Anggota
                        </button>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>Daftar Anggota</h3>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchMember" placeholder="Cari anggota..." onkeyup="searchMembers()">
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama</th>
                                        <th>NRG</th>
                                        <th>No. HP</th>
                                        <th>Sekolah</th>
                                        <th>Role</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="membersTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Payments Section -->
                <section id="sectionPayments" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-money-bill-wave"></i> Kelola Iuran</h2>
                            <p>Catat dan kelola pembayaran iuran anggota</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddPayment()" id="btnAddPayment">
                            <i class="fas fa-plus"></i>
                            Catat Pembayaran
                        </button>
                    </div>

                    <div class="cards-row">
                        <div class="info-card">
                            <div class="info-card-header">
                                <div class="info-card-icon green">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="info-card-value" id="payPaidCount">0</div>
                            <div class="info-card-label">Sudah Bayar Bulan Ini</div>
                        </div>
                        <div class="info-card">
                            <div class="info-card-header">
                                <div class="info-card-icon red">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                            </div>
                            <div class="info-card-value" id="payUnpaidCount">0</div>
                            <div class="info-card-label">Belum Bayar Bulan Ini</div>
                        </div>
                        <div class="info-card">
                            <div class="info-card-header">
                                <div class="info-card-icon orange">
                                    <i class="fas fa-coins"></i>
                                </div>
                            </div>
                            <div class="info-card-value" id="payMonthlyFee">Rp 0</div>
                            <div class="info-card-label">Iuran Per Bulan</div>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>Riwayat Pembayaran</h3>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <select id="filterMonth" onchange="loadPayments()" style="padding: 0.5rem 1rem; border-radius: 50px; border: 2px solid #e0e0e0;">
                                    <option value="">Semua Bulan</option>
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                                <select id="filterYear" onchange="loadPayments()" style="padding: 0.5rem 1rem; border-radius: 50px; border: 2px solid #e0e0e0;">
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Nama</th>
                                        <th>Bulan</th>
                                        <th>Tahun</th>
                                        <th>Jumlah</th>
                                        <th>Keterangan</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Finance Section -->
                <section id="sectionFinance" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-wallet"></i> Keuangan</h2>
                            <p>Ringkasan dan rincian keuangan KKG PAI</p>
                        </div>
                        <button class="btn btn-danger" onclick="showAddExpense()" id="btnAddExpense">
                            <i class="fas fa-minus-circle"></i>
                            Tambah Pengeluaran
                        </button>
                    </div>

                    <div class="saldo-card" style="background: var(--gradient-success);">
                        <div class="saldo-header">
                            <div>
                                <div class="saldo-label">Saldo Tersedia</div>
                                <div class="saldo-amount" id="finSaldo">Rp 0</div>
                            </div>
                            <i class="fas fa-piggy-bank" style="font-size: 3rem; opacity: 0.3;"></i>
                        </div>
                        <div class="saldo-details">
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="finPemasukan">Rp 0</div>
                                <div class="saldo-item-label">Pemasukan</div>
                            </div>
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="finPengeluaran">Rp 0</div>
                                <div class="saldo-item-label">Pengeluaran</div>
                            </div>
                            <div class="saldo-item">
                                <div class="saldo-item-value" id="finTunggakan">Rp 0</div>
                                <div class="saldo-item-label">Tunggakan</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3><i class="fas fa-receipt"></i> Rincian Pengeluaran</h3>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Keterangan</th>
                                        <th>Kategori</th>
                                        <th>Jumlah</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="expensesTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Allocations Section -->
                <section id="sectionAllocations" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-chart-pie"></i> Alokasi Dana</h2>
                            <p>Pengaturan dan monitoring alokasi penggunaan dana</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddAllocation()">
                            <i class="fas fa-plus"></i>
                            Tambah Alokasi
                        </button>
                    </div>

                    <div class="allocation-grid" id="allocationsGrid"></div>
                </section>

                <!-- Reports Section -->
                <section id="sectionReports" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-file-alt"></i> Laporan</h2>
                            <p>Rekap iuran dan keuangan</p>
                        </div>
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print"></i>
                            Cetak Laporan
                        </button>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>Rekap Iuran per Anggota Tahun <span id="reportYear">2024</span></h3>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama</th>
                                        <th>Jan</th>
                                        <th>Feb</th>
                                        <th>Mar</th>
                                        <th>Apr</th>
                                        <th>Mei</th>
                                        <th>Jun</th>
                                        <th>Jul</th>
                                        <th>Ags</th>
                                        <th>Sep</th>
                                        <th>Okt</th>
                                        <th>Nov</th>
                                        <th>Des</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="sectionSettings" class="content-section">
                    <div class="page-header">
                        <div class="page-title">
                            <h2><i class="fas fa-cog"></i> Pengaturan</h2>
                            <p>Konfigurasi aplikasi</p>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="form-group">
                            <label>Nominal Iuran Bulanan (Rp)</label>
                            <input type="number" id="settingAmount" value="50000">
                        </div>
                        <div class="form-group">
                            <label>Nama Organisasi</label>
                            <input type="text" id="settingOrgName" value="KKG PAI Kecamatan Nagreg">
                        </div>
                        <div class="form-group">
                            <label>Tahun Aktif</label>
                            <input type="number" id="settingYear" value="2024">
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i>
                            Simpan Pengaturan
                        </button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- ==================== MODALS ==================== -->
    
    <!-- Add/Edit Member Modal -->
    <div class="modal-overlay" id="memberModal">
        <div class="modal" style="max-width: 550px;">
            <button class="close-modal" onclick="closeMemberModal()">Ã—</button>
            <div class="modal-header">
                <i class="fas fa-user-plus"></i>
                <h3 id="memberModalTitle">Tambah Anggota</h3>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editMemberId">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="memberName" placeholder="Nama lengkap anggota">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>NRG</label>
                        <input type="text" id="memberNRG" placeholder="Nomor Registrasi Guru">
                    </div>
                    <div class="form-group">
                        <label>Nomor HP</label>
                        <input type="tel" id="memberPhone" placeholder="08xxxxxxxxxx">
                    </div>
                </div>
                <div class="form-group">
                    <label>Sekolah</label>
                    <input type="text" id="memberSchool" placeholder="Nama sekolah">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="memberRole">
                        <option value="anggota">Anggota</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-block" onclick="saveMember()">
                    <i class="fas fa-save"></i>
                    Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal" style="max-width: 500px;">
            <button class="close-modal" onclick="closePaymentModal()">Ã—</button>
            <div class="modal-header">
                <i class="fas fa-money-bill-wave"></i>
                <h3>Catat Pembayaran</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Pilih Anggota</label>
                    <select id="paymentMember"></select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Bulan</label>
                        <select id="paymentMonth">
                            <option value="1">Januari</option>
                            <option value="2">Februari</option>
                            <option value="3">Maret</option>
                            <option value="4">April</option>
                            <option value="5">Mei</option>
                            <option value="6">Juni</option>
                            <option value="7">Juli</option>
                            <option value="8">Agustus</option>
                            <option value="9">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12">Desember</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tahun</label>
                        <select id="paymentYear">
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Jumlah (Rp)</label>
                    <input type="number" id="paymentAmount">
                </div>
                <div class="form-group">
                    <label>Tanggal Bayar</label>
                    <input type="date" id="paymentDate">
                </div>
                <div class="form-group">
                    <label>Keterangan</label>
                    <input type="text" id="paymentNote" placeholder="Catatan (opsional)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-block" onclick="savePayment()">
                    <i class="fas fa-save"></i>
                    Simpan Pembayaran
                </button>
            </div>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal-overlay" id="expenseModal">
        <div class="modal" style="max-width: 500px;">
            <button class="close-modal" onclick="closeExpenseModal()">Ã—</button>
            <div class="modal-header danger">
                <i class="fas fa-minus-circle"></i>
                <h3>Catat Pengeluaran</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="expenseDate">
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="expenseCategory"></select>
                </div>
                <div class="form-group">
                    <label>Jumlah (Rp)</label>
                    <input type="number" id="expenseAmount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Keterangan</label>
                    <textarea id="expenseNote" rows="3" placeholder="Detail pengeluaran..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger btn-block" onclick="saveExpense()">
                    <i class="fas fa-save"></i>
                    Simpan Pengeluaran
                </button>
            </div>
        </div>
    </div>

    <!-- Add Allocation Modal -->
    <div class="modal-overlay" id="allocationModal">
        <div class="modal" style="max-width: 450px;">
            <button class="close-modal" onclick="closeAllocationModal()">Ã—</button>
            <div class="modal-header" style="background: var(--gradient-purple);">
                <i class="fas fa-chart-pie"></i>
                <h3>Tambah Alokasi Dana</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nama Alokasi</label>
                    <input type="text" id="allocationName" placeholder="Contoh: Dana Kegiatan">
                </div>
                <div class="form-group">
                    <label>Budget (Rp)</label>
                    <input type="number" id="allocationBudget" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Warna</label>
                    <select id="allocationColor">
                        <option value="blue">Biru</option>
                        <option value="green">Hijau</option>
                        <option value="orange">Orange</option>
                        <option value="purple">Ungu</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-block" onclick="saveAllocation()">
                    <i class="fas fa-save"></i>
                    Simpan Alokasi
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyByFzY3dyDMOl9HRpgmvtKotce_hXdPMD4",
            authDomain: "iurankkg.firebaseapp.com",
            databaseURL: "https://iurankkg-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "iurankkg",
            storageBucket: "iurankkg.firebasestorage.app",
            messagingSenderId: "1083872413880",
            appId: "1:1083872413880:web:f7487176421c5da6ddcc4d",
            measurementId: "G-G1PP6GH236"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let isOnline = true;
        
        let appData = {
            settings: { monthlyAmount: 50000, orgName: 'KKG PAI Kecamatan Nagreg', year: 2024 },
            members: [],
            payments: [],
            expenses: [],
            allocations: []
        };

        const MONTHS = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
        const MONTHS_SHORT = ['', 'Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Ags', 'Sep', 'Okt', 'Nov', 'Des'];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            // Check online status
            db.ref('.info/connected').on('value', (snap) => {
                isOnline = snap.val() === true;
                updateOnlineStatus();
            });

            // Load data from Firebase
            loadFirebaseData();

            // Start countdown
            startCountdown();
        }

        function loadFirebaseData() {
            let loadedCount = 0;
            const refs = ['settings', 'members', 'payments', 'expenses', 'allocations'];

            refs.forEach(ref => {
                db.ref(ref).on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        if (ref === 'settings') {
                            appData.settings = { ...appData.settings, ...data };
                        } else {
                            appData[ref] = Object.keys(data).map(key => ({ id: key, ...data[key] }));
                        }
                    }
                    
                    loadedCount++;
                    if (loadedCount >= refs.length) {
                        hideLoading();
                        renderHomepage();
                        if (currentUser) {
                            renderDashboard();
                        }
                    }
                }, (error) => {
                    console.error(`Error loading ${ref}:`, error);
                    loadedCount++;
                    if (loadedCount >= refs.length) {
                        hideLoading();
                        // Initialize with demo data if needed
                        if (appData.members.length === 0) {
                            initDemoData();
                        }
                        renderHomepage();
                    }
                });
            });

            // Fallback timeout
            setTimeout(() => {
                if (document.getElementById('loadingScreen').style.display !== 'none') {
                    hideLoading();
                    if (appData.members.length === 0) {
                        initDemoData();
                    }
                    renderHomepage();
                }
            }, 5000);
        }

        function initDemoData() {
            const demoMembers = [
                { name: 'Ahmad Fauzi, S.Pd.I', nrg: '123456789', phone: '081234567890', school: 'SDN 1 Nagreg', role: 'admin' },
                { name: 'Siti Aminah, S.Ag', nrg: '234567890', phone: '081234567891', school: 'SDN 2 Nagreg', role: 'anggota' },
                { name: 'Muhammad Ridwan, S.Pd.I', nrg: '345678901', phone: '081234567892', school: 'SDN 3 Nagreg', role: 'anggota' },
                { name: 'Dewi Sartika, S.Ag', nrg: '456789012', phone: '081234567893', school: 'SDN 4 Nagreg', role: 'anggota' },
                { name: 'Abdul Rahman, S.Pd.I', nrg: '567890123', phone: '081234567894', school: 'SDN 5 Nagreg', role: 'anggota' },
                { name: 'Nur Hasanah, S.Ag', nrg: '678901234', phone: '081234567895', school: 'MI Al-Hikmah', role: 'anggota' },
                { name: 'Usman Hakim, S.Pd.I', nrg: '789012345', phone: '081234567896', school: 'MI Nurul Huda', role: 'anggota' },
                { name: 'Fatimah Zahra, S.Ag', nrg: '890123456', phone: '081234567897', school: 'SDN 6 Nagreg', role: 'anggota' }
            ];

            demoMembers.forEach(m => {
                const id = Date.now().toString() + Math.random().toString(36).substr(2, 5);
                db.ref('members/' + id).set(m);
            });

            const demoAllocations = [
                { name: 'Kegiatan Bersama', budget: 500000, color: 'blue' },
                { name: 'ATK & Administrasi', budget: 200000, color: 'green' },
                { name: 'Transport', budget: 150000, color: 'orange' },
                { name: 'Dana Darurat', budget: 300000, color: 'purple' }
            ];

            demoAllocations.forEach(a => {
                const id = Date.now().toString() + Math.random().toString(36).substr(2, 5);
                db.ref('allocations/' + id).set(a);
            });

            db.ref('settings').set(appData.settings);
        }

        function hideLoading() {
            document.getElementById('loadingScreen').style.display = 'none';
        }

        function updateOnlineStatus() {
            const dots = document.querySelectorAll('.online-dot');
            const texts = document.querySelectorAll('[id^="onlineStatus"]');
            
            dots.forEach(dot => {
                dot.classList.toggle('offline', !isOnline);
            });
            
            texts.forEach(text => {
                text.textContent = isOnline ? 'Online' : 'Offline';
            });
        }

        // ==================== COUNTDOWN ====================
        function startCountdown() {
            function update() {
                const now = new Date();
                const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
                const diff = endOfMonth - now;

                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    document.getElementById('countDays').textContent = String(days).padStart(2, '0');
                    document.getElementById('countHours').textContent = String(hours).padStart(2, '0');
                    document.getElementById('countMinutes').textContent = String(minutes).padStart(2, '0');
                    document.getElementById('countSeconds').textContent = String(seconds).padStart(2, '0');
                }
            }

            update();
            setInterval(update, 1000);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function formatNumber(n) {
            return new Intl.NumberFormat('id-ID').format(n || 0);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMessage');
            
            toast.className = `toast show ${type}`;
            toastMsg.textContent = message;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showSync() {
            document.getElementById('syncIndicator').classList.add('show');
        }

        function hideSync() {
            document.getElementById('syncIndicator').classList.remove('show');
        }

        // ==================== HOMEPAGE RENDERING ====================
        function renderHomepage() {
            renderStats();
            renderRunningText();
            renderMarquee();
            renderMembersGrid('all');
        }

        function getUnpaidMembers() {
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();

            return appData.members.map(member => {
                const payments = appData.payments.filter(p => p.memberId === member.id && parseInt(p.year) === currentYear);
                const paidMonths = payments.map(p => parseInt(p.month));
                const totalPaid = payments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
                const expectedAmount = currentMonth * appData.settings.monthlyAmount;
                const debt = Math.max(0, expectedAmount - totalPaid);

                let status = 'paid';
                if (totalPaid === 0) {
                    status = 'unpaid';
                } else if (debt > 0) {
                    status = 'partial';
                }

                return { ...member, paidMonths, totalPaid, debt, status };
            }).filter(m => m.status !== 'paid');
        }

        function renderStats() {
            const totalMembers = appData.members.length;
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();

            const paidThisMonth = appData.members.filter(m => {
                return appData.payments.some(p => 
                    p.memberId === m.id && 
                    parseInt(p.month) === currentMonth && 
                    parseInt(p.year) === currentYear &&
                    parseInt(p.amount) >= appData.settings.monthlyAmount
                );
            }).length;

            const totalIncome = appData.payments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
            const totalExpense = appData.expenses.reduce((sum, e) => sum + (parseInt(e.amount) || 0), 0);
            const balance = totalIncome - totalExpense;

            document.getElementById('statsSection').innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-number">${totalMembers}</div>
                    <div class="stat-label">Total Anggota</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-number">${paidThisMonth}</div>
                    <div class="stat-label">Lunas Bulan Ini</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-number">${totalMembers - paidThisMonth}</div>
                    <div class="stat-label">Belum Bayar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                    <div class="stat-number">Rp ${formatNumber(balance)}</div>
                    <div class="stat-label">Saldo KKG</div>
                </div>
            `;
        }

        function renderRunningText() {
            const unpaid = getUnpaidMembers();
            const names = unpaid.map(m => m.name.split(',')[0]).join(' â€¢ ') || 'Semua anggota sudah lunas!';
            
            const messages = [
                `<i class="fas fa-bell"></i> PERHATIAN: ${unpaid.length} anggota belum melunasi iuran bulan ini`,
                `<i class="fas fa-users"></i> ${names}`,
                `<i class="fas fa-heart"></i> Mari jaga kebersamaan dengan membayar iuran tepat waktu`,
                `<i class="fas fa-clock"></i> Jatuh tempo pembayaran: Akhir bulan ini`,
                `<i class="fas fa-star"></i> Terima kasih kepada anggota yang sudah melunasi iuran`
            ];

            const track = document.getElementById('runningTrack');
            track.innerHTML = messages.map(m => `<span class="running-item">${m}</span>`).join('').repeat(2);
        }

        function renderMarquee() {
            const unpaid = getUnpaidMembers();
            const currentMonth = new Date().getMonth() + 1;

            if (unpaid.length === 0) {
                document.getElementById('marqueeTrack').innerHTML = `
                    <div class="all-paid-card">
                        <i class="fas fa-check-circle"></i>
                        <h4>Alhamdulillah! ðŸŽ‰</h4>
                        <p>Semua anggota sudah melunasi iuran bulan ini</p>
                    </div>
                `;
                return;
            }

            const cards = [...unpaid, ...unpaid].map(m => {
                let monthsHtml = '';
                for (let i = 1; i <= currentMonth; i++) {
                    const isPaid = m.paidMonths.includes(i);
                    monthsHtml += `<span class="month-tag ${isPaid ? 'paid' : 'unpaid'}">${MONTHS_SHORT[i]}</span>`;
                }

                return `
                    <div class="marquee-card ${m.status === 'partial' ? 'partial' : ''}">
                        <div class="marquee-card-header">
                            <div class="marquee-avatar">${getInitials(m.name)}</div>
                            <div class="marquee-info">
                                <h4>${m.name}</h4>
                                <p><i class="fas fa-school"></i> ${m.school}</p>
                            </div>
                        </div>
                        <div class="marquee-debt">
                            <div class="marquee-debt-label">TUNGGAKAN</div>
                            <div class="marquee-debt-amount">Rp ${formatNumber(m.debt)}</div>
                        </div>
                        <div class="marquee-months">${monthsHtml}</div>
                        <div class="marquee-cta">
                            <span class="marquee-cta-btn">
                                <i class="fas fa-exclamation-triangle"></i>
                                Segera Lunasi!
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('marqueeTrack').innerHTML = cards;
        }

        function renderMembersGrid(filter) {
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();

            let members = appData.members.map(member => {
                const payments = appData.payments.filter(p => p.memberId === member.id && parseInt(p.year) === currentYear);
                const paidMonths = payments.map(p => parseInt(p.month));
                const totalPaid = payments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
                const expectedAmount = currentMonth * appData.settings.monthlyAmount;
                const debt = Math.max(0, expectedAmount - totalPaid);

                let status = 'paid';
                if (totalPaid === 0) {
                    status = 'unpaid';
                } else if (debt > 0) {
                    status = 'partial';
                }

                return { ...member, paidMonths, totalPaid, debt, status };
            });

            if (filter !== 'all') {
                members = members.filter(m => m.status === filter);
            }

            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');

            const grid = document.getElementById('membersGrid');

            if (members.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h4>Tidak Ada Data</h4>
                        <p>Tidak ada anggota dengan status ini</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = members.map(m => {
                let monthsHtml = '';
                for (let i = 1; i <= currentMonth; i++) {
                    const isPaid = m.paidMonths.includes(i);
                    monthsHtml += `<span class="month-badge ${isPaid ? 'paid' : 'unpaid'}">${MONTHS_SHORT[i]}</span>`;
                }

                return `
                    <div class="member-card ${m.status}">
                        <div class="member-card-header">
                            <div class="member-avatar">${getInitials(m.name)}</div>
                            <div class="member-details">
                                <h4>${m.name}</h4>
                                <p><i class="fas fa-school"></i> ${m.school}</p>
                            </div>
                        </div>
                        <div class="member-card-body">
                            <div class="status-box ${m.status}">
                                <div class="status-label">${m.debt > 0 ? 'Tunggakan' : 'Status'}</div>
                                <div class="status-value ${m.status}">
                                    ${m.debt > 0 ? 'Rp ' + formatNumber(m.debt) : 'âœ“ LUNAS'}
                                </div>
                            </div>
                            <div style="font-size: 0.85rem; color: #888; margin-bottom: 0.5rem;">Status per bulan:</div>
                            <div class="months-row">${monthsHtml}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterMembers(filter) {
            renderMembersGrid(filter);
        }

        // ==================== LOGIN/LOGOUT ====================
        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('loginPhone').value = '';
            document.getElementById('loginNRG').value = '';
        }

        function doLogin() {
            const phone = document.getElementById('loginPhone').value.trim();
            const nrg = document.getElementById('loginNRG').value.trim();

            if (!phone || !nrg) {
                showToast('Harap isi semua field!', 'error');
                return;
            }

            const member = appData.members.find(m => m.phone === phone && m.nrg === nrg);

            if (member) {
                currentUser = member;
                closeLogin();
                document.getElementById('homePage').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                renderDashboard();
                showToast(`Selamat datang, ${member.name}!`, 'success');
            } else {
                showToast('Nomor HP atau NRG tidak valid!', 'error');
            }
        }

        function doLogout() {
            currentUser = null;
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('homePage').style.display = 'block';
            showToast('Anda telah logout', 'success');
        }

        function goHome() {
            if (currentUser) {
                doLogout();
            }
        }

        // ==================== DASHBOARD ====================
        function renderDashboard() {
            if (!currentUser) return;

            const isAdmin = currentUser.role === 'admin';

            // Update sidebar
            document.getElementById('sidebarAvatar').textContent = getInitials(currentUser.name);
            document.getElementById('sidebarName').textContent = currentUser.name;
            document.getElementById('sidebarRole').textContent = isAdmin ? 'Administrator' : 'Anggota';
            document.getElementById('navSubtitle').textContent = isAdmin ? 'Panel Admin' : 'Portal Anggota';
            document.getElementById('welcomeText').textContent = `Selamat datang, ${currentUser.name.split(' ')[0]}!`;

            // Show date
            const now = new Date();
            document.getElementById('dateDisplay').textContent = now.toLocaleDateString('id-ID', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });

            // Show/hide admin menus
            document.getElementById('menuMembers').style.display = isAdmin ? 'flex' : 'none';
            document.getElementById('menuAllocations').style.display = isAdmin ? 'flex' : 'none';
            document.getElementById('menuSettings').style.display = isAdmin ? 'flex' : 'none';
            document.getElementById('btnAddPayment').style.display = isAdmin ? 'inline-flex' : 'none';
            document.getElementById('btnAddExpense').style.display = isAdmin ? 'inline-flex' : 'none';

            // Calculate totals
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();
            const totalIncome = appData.payments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
            const totalExpense = appData.expenses.reduce((sum, e) => sum + (parseInt(e.amount) || 0), 0);
            const balance = totalIncome - totalExpense;
            const expectedTotal = appData.members.length * currentMonth * appData.settings.monthlyAmount;
            const arrears = Math.max(0, expectedTotal - totalIncome);

            // Update saldo cards
            document.getElementById('saldoAmount').textContent = 'Rp ' + formatNumber(balance);
            document.getElementById('saldoPemasukan').textContent = 'Rp ' + formatNumber(totalIncome);
            document.getElementById('saldoPengeluaran').textContent = 'Rp ' + formatNumber(totalExpense);
            document.getElementById('saldoTunggakan').textContent = 'Rp ' + formatNumber(arrears);

            // Dashboard cards
            if (isAdmin) {
                document.getElementById('dashboardCards').innerHTML = `
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon blue"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="info-card-value">${appData.members.length}</div>
                        <div class="info-card-label">Total Anggota</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon green"><i class="fas fa-check-circle"></i></div>
                        </div>
                        <div class="info-card-value">${appData.payments.filter(p => parseInt(p.month) === currentMonth && parseInt(p.year) === currentYear).length}</div>
                        <div class="info-card-label">Bayar Bulan Ini</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon orange"><i class="fas fa-receipt"></i></div>
                        </div>
                        <div class="info-card-value">${appData.payments.length}</div>
                        <div class="info-card-label">Total Transaksi</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon red"><i class="fas fa-exclamation-triangle"></i></div>
                        </div>
                        <div class="info-card-value">Rp ${formatNumber(arrears)}</div>
                        <div class="info-card-label">Total Tunggakan</div>
                    </div>
                `;
            } else {
                const myPayments = appData.payments.filter(p => p.memberId === currentUser.id && parseInt(p.year) === currentYear);
                const myTotalPaid = myPayments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
                const myExpected = currentMonth * appData.settings.monthlyAmount;
                const myDebt = Math.max(0, myExpected - myTotalPaid);

                document.getElementById('dashboardCards').innerHTML = `
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon blue"><i class="fas fa-calendar-check"></i></div>
                        </div>
                        <div class="info-card-value">${myPayments.length}</div>
                        <div class="info-card-label">Bulan Terbayar</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon green"><i class="fas fa-money-bill-wave"></i></div>
                        </div>
                        <div class="info-card-value">Rp ${formatNumber(myTotalPaid)}</div>
                        <div class="info-card-label">Total Dibayar</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon ${myDebt > 0 ? 'red' : 'green'}">
                                <i class="fas fa-${myDebt > 0 ? 'exclamation-circle' : 'check-circle'}"></i>
                            </div>
                        </div>
                        <div class="info-card-value">Rp ${formatNumber(myDebt)}</div>
                        <div class="info-card-label">${myDebt > 0 ? 'Tunggakan' : 'Lunas!'}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-header">
                            <div class="info-card-icon orange"><i class="fas fa-coins"></i></div>
                        </div>
                        <div class="info-card-value">Rp ${formatNumber(appData.settings.monthlyAmount)}</div>
                        <div class="info-card-label">Iuran/Bulan</div>
                    </div>
                `;
            }

            // Recent transactions
            const recentPayments = [...appData.payments].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            document.getElementById('recentTransactions').innerHTML = recentPayments.map(p => {
                const member = appData.members.find(m => m.id === p.memberId);
                const isLunas = parseInt(p.amount) >= appData.settings.monthlyAmount;
                return `
                    <tr>
                        <td>${formatDate(p.date)}</td>
                        <td>${member?.name || '-'}</td>
                        <td>${MONTHS[parseInt(p.month)]}</td>
                        <td>Rp ${formatNumber(p.amount)}</td>
                        <td><span class="badge ${isLunas ? 'badge-success' : 'badge-warning'}">${isLunas ? 'Lunas' : 'Sebagian'}</span></td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="5" style="text-align: center; color: #888;">Belum ada transaksi</td></tr>';

            // Load other sections
            loadMembers();
            loadPayments();
            loadFinance();
            loadAllocations();
            loadReports();
            loadSettings();
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            event?.target?.closest('.menu-item')?.classList.add('active');

            closeSidebar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }

        // ==================== MEMBERS MANAGEMENT ====================
        function loadMembers() {
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = appData.members.map((m, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${m.name}</td>
                    <td>${m.nrg}</td>
                    <td>${m.phone}</td>
                    <td>${m.school}</td>
                    <td><span class="badge ${m.role === 'admin' ? 'badge-primary' : 'badge-success'}">${m.role}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-primary btn-icon btn-sm" onclick="editMember('${m.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteMember('${m.id}')" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" style="text-align: center; color: #888;">Belum ada anggota</td></tr>';
        }

        function showAddMember() {
            document.getElementById('memberModalTitle').textContent = 'Tambah Anggota';
            document.getElementById('editMemberId').value = '';
            document.getElementById('memberName').value = '';
            document.getElementById('memberNRG').value = '';
            document.getElementById('memberPhone').value = '';
            document.getElementById('memberSchool').value = '';
            document.getElementById('memberRole').value = 'anggota';
            document.getElementById('memberModal').classList.add('active');
        }

        function editMember(id) {
            const member = appData.members.find(m => m.id === id);
            if (!member) return;

            document.getElementById('memberModalTitle').textContent = 'Edit Anggota';
            document.getElementById('editMemberId').value = id;
            document.getElementById('memberName').value = member.name;
            document.getElementById('memberNRG').value = member.nrg;
            document.getElementById('memberPhone').value = member.phone;
            document.getElementById('memberSchool').value = member.school;
            document.getElementById('memberRole').value = member.role;
            document.getElementById('memberModal').classList.add('active');
        }

        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('active');
        }

        function saveMember() {
            const id = document.getElementById('editMemberId').value;
            const data = {
                name: document.getElementById('memberName').value.trim(),
                nrg: document.getElementById('memberNRG').value.trim(),
                phone: document.getElementById('memberPhone').value.trim(),
                school: document.getElementById('memberSchool').value.trim(),
                role: document.getElementById('memberRole').value
            };

            if (!data.name || !data.nrg || !data.phone || !data.school) {
                showToast('Harap isi semua field!', 'error');
                return;
            }

            showSync();

            if (id) {
                db.ref('members/' + id).update(data).then(() => {
                    hideSync();
                    closeMemberModal();
                    showToast('Anggota berhasil diupdate!', 'success');
                }).catch(err => {
                    hideSync();
                    showToast('Gagal menyimpan: ' + err.message, 'error');
                });
            } else {
                const newId = db.ref('members').push().key;
                db.ref('members/' + newId).set(data).then(() => {
                    hideSync();
                    closeMemberModal();
                    showToast('Anggota berhasil ditambahkan!', 'success');
                }).catch(err => {
                    hideSync();
                    showToast('Gagal menyimpan: ' + err.message, 'error');
                });
            }
        }

        function deleteMember(id) {
            if (!confirm('Yakin ingin menghapus anggota ini?')) return;

            showSync();
            db.ref('members/' + id).remove().then(() => {
                // Also delete related payments
                appData.payments.filter(p => p.memberId === id).forEach(p => {
                    db.ref('payments/' + p.id).remove();
                });
                hideSync();
                showToast('Anggota berhasil dihapus!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menghapus: ' + err.message, 'error');
            });
        }

        function searchMembers() {
            const query = document.getElementById('searchMember').value.toLowerCase();
            const rows = document.querySelectorAll('#membersTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // ==================== PAYMENTS MANAGEMENT ====================
        function loadPayments() {
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();

            const paidThisMonth = new Set(
                appData.payments.filter(p => 
                    parseInt(p.month) === currentMonth && 
                    parseInt(p.year) === currentYear &&
                    parseInt(p.amount) >= appData.settings.monthlyAmount
                ).map(p => p.memberId)
            ).size;

            document.getElementById('payPaidCount').textContent = paidThisMonth;
            document.getElementById('payUnpaidCount').textContent = appData.members.length - paidThisMonth;
            document.getElementById('payMonthlyFee').textContent = 'Rp ' + formatNumber(appData.settings.monthlyAmount);

            const filterMonth = document.getElementById('filterMonth')?.value;
            const filterYear = document.getElementById('filterYear')?.value;

            let payments = [...appData.payments];

            if (filterMonth) {
                payments = payments.filter(p => parseInt(p.month) === parseInt(filterMonth));
            }
            if (filterYear) {
                payments = payments.filter(p => parseInt(p.year) === parseInt(filterYear));
            }

            if (currentUser?.role !== 'admin') {
                payments = payments.filter(p => p.memberId === currentUser.id);
            }

            payments.sort((a, b) => new Date(b.date) - new Date(a.date));

            const isAdmin = currentUser?.role === 'admin';
            const tbody = document.getElementById('paymentsTableBody');
            
            tbody.innerHTML = payments.map(p => {
                const member = appData.members.find(m => m.id === p.memberId);
                return `
                    <tr>
                        <td>${formatDate(p.date)}</td>
                        <td>${member?.name || '-'}</td>
                        <td>${MONTHS[parseInt(p.month)]}</td>
                        <td>${p.year}</td>
                        <td>Rp ${formatNumber(p.amount)}</td>
                        <td>${p.note || '-'}</td>
                        <td>
                            ${isAdmin ? `
                                <button class="btn btn-danger btn-icon btn-sm" onclick="deletePayment('${p.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : '-'}
                        </td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="7" style="text-align: center; color: #888;">Tidak ada data</td></tr>';

            // Populate member select
            document.getElementById('paymentMember').innerHTML = appData.members.map(m => 
                `<option value="${m.id}">${m.name}</option>`
            ).join('');
        }

        function showAddPayment() {
            document.getElementById('paymentAmount').value = appData.settings.monthlyAmount;
            document.getElementById('paymentDate').valueAsDate = new Date();
            document.getElementById('paymentMonth').value = new Date().getMonth() + 1;
            document.getElementById('paymentNote').value = '';
            document.getElementById('paymentModal').classList.add('active');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        function savePayment() {
            const data = {
                memberId: document.getElementById('paymentMember').value,
                month: document.getElementById('paymentMonth').value,
                year: document.getElementById('paymentYear').value,
                amount: parseInt(document.getElementById('paymentAmount').value) || 0,
                date: document.getElementById('paymentDate').value,
                note: document.getElementById('paymentNote').value.trim()
            };

            if (!data.memberId || !data.amount || !data.date) {
                showToast('Harap isi semua field yang diperlukan!', 'error');
                return;
            }

            showSync();
            const newId = db.ref('payments').push().key;
            db.ref('payments/' + newId).set(data).then(() => {
                hideSync();
                closePaymentModal();
                showToast('Pembayaran berhasil dicatat!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menyimpan: ' + err.message, 'error');
            });
        }

        function deletePayment(id) {
            if (!confirm('Yakin ingin menghapus pembayaran ini?')) return;

            showSync();
            db.ref('payments/' + id).remove().then(() => {
                hideSync();
                showToast('Pembayaran berhasil dihapus!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menghapus: ' + err.message, 'error');
            });
        }

        // ==================== FINANCE MANAGEMENT ====================
        function loadFinance() {
            const totalIncome = appData.payments.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0);
            const totalExpense = appData.expenses.reduce((sum, e) => sum + (parseInt(e.amount) || 0), 0);
            const balance = totalIncome - totalExpense;

            const currentMonth = new Date().getMonth() + 1;
            const expectedTotal = appData.members.length * currentMonth * appData.settings.monthlyAmount;
            const arrears = Math.max(0, expectedTotal - totalIncome);

            document.getElementById('finSaldo').textContent = 'Rp ' + formatNumber(balance);
            document.getElementById('finPemasukan').textContent = 'Rp ' + formatNumber(totalIncome);
            document.getElementById('finPengeluaran').textContent = 'Rp ' + formatNumber(totalExpense);
            document.getElementById('finTunggakan').textContent = 'Rp ' + formatNumber(arrears);

            const isAdmin = currentUser?.role === 'admin';
            const tbody = document.getElementById('expensesTableBody');

            tbody.innerHTML = appData.expenses.map(e => `
                <tr>
                    <td>${formatDate(e.date)}</td>
                    <td>${e.note}</td>
                    <td><span class="badge badge-warning">${e.category || 'Umum'}</span></td>
                    <td>Rp ${formatNumber(e.amount)}</td>
                    <td>
                        ${isAdmin ? `
                            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteExpense('${e.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : '-'}
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" style="text-align: center; color: #888;">Belum ada pengeluaran</td></tr>';

            // Populate category select
            document.getElementById('expenseCategory').innerHTML = appData.allocations.map(a => 
                `<option value="${a.name}">${a.name}</option>`
            ).join('') || '<option value="Umum">Umum</option>';
        }

        function showAddExpense() {
            document.getElementById('expenseDate').valueAsDate = new Date();
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseNote').value = '';
            document.getElementById('expenseModal').classList.add('active');
        }

        function closeExpenseModal() {
            document.getElementById('expenseModal').classList.remove('active');
        }

        function saveExpense() {
            const data = {
                date: document.getElementById('expenseDate').value,
                category: document.getElementById('expenseCategory').value,
                amount: parseInt(document.getElementById('expenseAmount').value) || 0,
                note: document.getElementById('expenseNote').value.trim()
            };

            if (!data.date || !data.amount || !data.note) {
                showToast('Harap isi semua field!', 'error');
                return;
            }

            showSync();
            const newId = db.ref('expenses').push().key;
            db.ref('expenses/' + newId).set(data).then(() => {
                hideSync();
                closeExpenseModal();
                showToast('Pengeluaran berhasil dicatat!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menyimpan: ' + err.message, 'error');
            });
        }

        function deleteExpense(id) {
            if (!confirm('Yakin ingin menghapus pengeluaran ini?')) return;

            showSync();
            db.ref('expenses/' + id).remove().then(() => {
                hideSync();
                showToast('Pengeluaran berhasil dihapus!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menghapus: ' + err.message, 'error');
            });
        }

        // ==================== ALLOCATIONS MANAGEMENT ====================
        function loadAllocations() {
            const grid = document.getElementById('allocationsGrid');

            grid.innerHTML = appData.allocations.map(a => {
                const used = appData.expenses
                    .filter(e => e.category === a.name)
                    .reduce((sum, e) => sum + (parseInt(e.amount) || 0), 0);
                const percentage = a.budget > 0 ? Math.min((used / a.budget) * 100, 100) : 0;
                const remaining = a.budget - used;

                return `
                    <div class="allocation-card">
                        <div class="allocation-header">
                            <span class="allocation-title">${a.name}</span>
                            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteAllocation('${a.id}')" style="width: 30px; height: 30px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${a.color}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="progress-info">
                            <span>Terpakai: Rp ${formatNumber(used)}</span>
                            <span>${percentage.toFixed(0)}%</span>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: #888; font-size: 0.85rem;">Budget:</span>
                                <span style="font-weight: 600;">Rp ${formatNumber(a.budget)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #888; font-size: 0.85rem;">Sisa:</span>
                                <span style="font-weight: 600; color: ${remaining >= 0 ? 'var(--success)' : 'var(--danger)'};">Rp ${formatNumber(remaining)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('') || '<div class="empty-state"><i class="fas fa-chart-pie"></i><h4>Belum Ada Alokasi</h4><p>Tambahkan alokasi dana untuk mengelola anggaran</p></div>';
        }

        function showAddAllocation() {
            document.getElementById('allocationName').value = '';
            document.getElementById('allocationBudget').value = '';
            document.getElementById('allocationColor').value = 'blue';
            document.getElementById('allocationModal').classList.add('active');
        }

        function closeAllocationModal() {
            document.getElementById('allocationModal').classList.remove('active');
        }

        function saveAllocation() {
            const data = {
                name: document.getElementById('allocationName').value.trim(),
                budget: parseInt(document.getElementById('allocationBudget').value) || 0,
                color: document.getElementById('allocationColor').value
            };

            if (!data.name || !data.budget) {
                showToast('Harap isi semua field!', 'error');
                return;
            }

            showSync();
            const newId = db.ref('allocations').push().key;
            db.ref('allocations/' + newId).set(data).then(() => {
                hideSync();
                closeAllocationModal();
                showToast('Alokasi berhasil ditambahkan!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menyimpan: ' + err.message, 'error');
            });
        }

        function deleteAllocation(id) {
            if (!confirm('Yakin ingin menghapus alokasi ini?')) return;

            showSync();
            db.ref('allocations/' + id).remove().then(() => {
                hideSync();
                showToast('Alokasi berhasil dihapus!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menghapus: ' + err.message, 'error');
            });
        }

        // ==================== REPORTS ====================
        function loadReports() {
            const currentYear = new Date().getFullYear();
            document.getElementById('reportYear').textContent = currentYear;

            const tbody = document.getElementById('reportTableBody');

            tbody.innerHTML = appData.members.map((member, index) => {
                const payments = appData.payments.filter(p => p.memberId === member.id && parseInt(p.year) === currentYear);
                let monthCells = '';
                let total = 0;

                for (let i = 1; i <= 12; i++) {
                    const payment = payments.find(p => parseInt(p.month) === i);
                    const amount = payment ? parseInt(payment.amount) || 0 : 0;
                    total += amount;

                    const isPaid = amount >= appData.settings.monthlyAmount;
                    const isPartial = amount > 0 && amount < appData.settings.monthlyAmount;

                    monthCells += `<td style="text-align: center;">
                        ${isPaid ? '<i class="fas fa-check-circle" style="color: var(--success);"></i>' : 
                          isPartial ? '<i class="fas fa-minus-circle" style="color: var(--warning);"></i>' : 
                          '<i class="fas fa-times-circle" style="color: var(--danger);"></i>'}
                    </td>`;
                }

                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${member.name}</td>
                        ${monthCells}
                        <td style="font-weight: 600;">Rp ${formatNumber(total)}</td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="15" style="text-align: center; color: #888;">Tidak ada data</td></tr>';
        }

        // ==================== SETTINGS ====================
        function loadSettings() {
            document.getElementById('settingAmount').value = appData.settings.monthlyAmount;
            document.getElementById('settingOrgName').value = appData.settings.orgName;
            document.getElementById('settingYear').value = appData.settings.year;
        }

        function saveSettings() {
            const settings = {
                monthlyAmount: parseInt(document.getElementById('settingAmount').value) || 50000,
                orgName: document.getElementById('settingOrgName').value.trim(),
                year: parseInt(document.getElementById('settingYear').value) || 2024
            };

            showSync();
            db.ref('settings').set(settings).then(() => {
                hideSync();
                showToast('Pengaturan berhasil disimpan!', 'success');
            }).catch(err => {
                hideSync();
                showToast('Gagal menyimpan: ' + err.message, 'error');
            });
        }

        // ==================== MODAL HANDLERS ====================
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Enter key for login
        document.getElementById('loginNRG').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                doLogin();
            }
        });
    </script>
</body>
</html>
